# 生産管理システム実習

## chatgpt に聞いた MQTT

**MQTT（Message Queuing Telemetry Transport）**は、軽量で効率的な通信プロトコルで、特に低帯域幅や高遅延のネットワーク環境に適した設計がされています。IoT（モノのインターネット）やモバイルアプリケーションでよく利用されます。

### 主な特徴
1. **パブリッシュ/サブスクライブモデル**  
   - クライアントは特定のトピックにメッセージを**パブリッシュ（送信）**したり、そのトピックを**サブスクライブ（購読）**したりできます。
   - クライアント同士が直接通信するのではなく、**ブローカー**（サーバー）がメッセージを仲介します。
  
<center>
<img src="./images/mqtt.png" width="60%">
</center>

2. **軽量性**  
   - ヘッダー情報が少なく、データ量が最小限に抑えられるため、通信が低コストです。

3. **品質保証レベル（QoS）**  
   - 配信の信頼性を指定可能。
     - **QoS 0**: メッセージは「送信するだけ」（配送保証なし）。
     - **QoS 1**: 必ず「少なくとも1回」配信される。
     - **QoS 2**: 必ず「1回だけ」配信される。

4. **常時接続**  
   - クライアントはブローカーに対して接続を維持するため、リアルタイム性が高い。

5. **柔軟性**  
   - トピックの階層構造（例: `home/kitchen/temperature`）を使用して、通信内容を整理できます。

### 主な用途
- IoTデバイス間の通信（センサー、スマート家電など）
- リアルタイムモニタリング（温度、湿度などのデータ収集）
- チャットアプリや通知サービス

### メリットとデメリット
**メリット:**
- ネットワーク負荷が少ない
- シンプルなプロトコル設計
- リアルタイム性に優れる

**デメリット:**
- ブローカーに依存するため、シングルポイント障害（SPoF）が発生する可能性
- セキュリティ機能は組み込みでなく、TLSなどで補う必要がある

簡単に言えば、MQTTは「小さなデータを効率的に送受信するための仕組み」で、特にIoTシステムでその威力を発揮します。


## MQTT ブローカー

MQTT を利用するにはブローカー (仲介者) が必要ですが、ここでは外部のサービスを利用して、偶数の出席番号の人が publisher となり、奇数の出席番号の人が subscriber となって、データを受け取ってみましょう。

### shiftr.io

https://www.shiftr.io/ はインターネット上に公開されている MQTT ブローカーです。試用であれば無料で利用できます。

<center>
<img src="images/shiftr.io.png" width="60%">
</center>

**課題５：publisher (出席番号偶数) から自分の PLC の D1 の値を MQTT に publish し、subscriber (出席番号奇数) はそれを受け取り、Dashboard に反映させてください。**
